# 🎨 Price Comparator - Визуальное руководство

## 📱 Интерфейс пользователя

### 1️⃣ Главная страница

```
┌─────────────────────────────────────────────────────────┐
│  🏠 SEO инструменты                                     │
│                                                         │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐       │
│  │ 🔄     │  │ 🧹     │  │ 🤖     │  │ 📊     │       │
│  │Redirect│  │ Clean  │  │Robots  │  │Traffic │       │
│  └────────┘  └────────┘  └────────┘  └────────┘       │
│                                                         │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐       │
│  │ 🔤     │  │ 🧼     │  │ 🔗     │  │ 💰     │  ← NEW│
│  │Translit│  │ URL    │  │Knowledge│ │ Price  │       │
│  └────────┘  └────────┘  └────────┘  └────────┘       │
└─────────────────────────────────────────────────────────┘
```

---

### 2️⃣ Price Comparator - Форма ввода

```
┌─────────────────────────────────────────────────────────┐
│  💰 Анализатор цен конкурентов                          │
│  AI-powered инструмент для сравнения цен                │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  🔑 OpenAI API Ключ                                     │
│  ┌───────────────────────────────────────┬───────────┐  │
│  │ sk-••••••••••••••••••••••••••••••••• │ 👁️ Показать │  │
│  └───────────────────────────────────────┴───────────┘  │
│  Получите на platform.openai.com                        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  📍 Ваш сайт                                            │
│                                                         │
│  Страница с описанием услуг:                            │
│  ┌───────────────────────────────────────────────────┐  │
│  │ https://mysite.com/services                       │  │
│  └───────────────────────────────────────────────────┘  │
│                                                         │
│  Страница с ценами:                                     │
│  ┌───────────────────────────────────────────────────┐  │
│  │ https://mysite.com/prices                         │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  🏢 Конкуренты                                          │
│                                                         │
│  ┌──────────────────┬───────────────────────────┬───┐   │
│  │ Конкурент 1      │ https://comp1.com/prices  │ ❌ │   │
│  └──────────────────┴───────────────────────────┴───┘   │
│                                                         │
│  ┌──────────────────┬───────────────────────────┬───┐   │
│  │ Конкурент 2      │ https://comp2.com/prajs   │ ❌ │   │
│  └──────────────────┴───────────────────────────┴───┘   │
│                                                         │
│  ┌──────────────────┬───────────────────────────┬───┐   │
│  │ Конкурент 3      │ https://comp3.com/ceny    │ ❌ │   │
│  └──────────────────┴───────────────────────────┴───┘   │
│                                                         │
│  ┌────────────────────────┐                             │
│  │ + Добавить конкурента  │                             │
│  └────────────────────────┘                             │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│           🚀 НАЧАТЬ АНАЛИЗ                              │
└─────────────────────────────────────────────────────────┘
```

---

### 3️⃣ Процесс анализа (Real-time прогресс)

```
┌─────────────────────────────────────────────────────────┐
│  🔄 Загружаем HTML страниц...                           │
└─────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────┐
│  🧹 Очищаем HTML от лишних элементов...                 │
└─────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────┐
│  🤖 Анализируем ваш сайт с помощью AI...                │
└─────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────┐
│  📊 Анализируем конкурента 1/3: Конкурент 1...          │
└─────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────┐
│  📊 Анализируем конкурента 2/3: Конкурент 2...          │
└─────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────┐
│  📊 Анализируем конкурента 3/3: Конкурент 3...          │
└─────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────┐
│  🔗 Сопоставляем услуги и создаем сводную таблицу...    │
└─────────────────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────────────────┐
│  ✅ Анализ завершен!                                    │
└─────────────────────────────────────────────────────────┘
```

---

### 4️⃣ Результаты - Таблица сравнения

```
┌──────────────────────────────────────────────────────────────────────────┐
│  📊 Результаты сравнения                                                 │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────┐
│ Услуга               │ Наша цена │ Конкурент 1 │ Конкурент 2 │ Конкурент 3│
├──────────────────────┼───────────┼─────────────┼─────────────┼────────────┤
│ Уборка 1-комнатной   │  2500 ₽   │   2300 ₽    │   2700 ₽    │     —      │
│ Уборка 2-комнатной   │  3500 ₽   │   3200 ₽    │   3800 ₽    │   3600 ₽   │
│ Уборка 3-комнатной   │  4500 ₽   │   4100 ₽    │   4800 ₽    │   4600 ₽   │
│ Генеральная уборка   │  5500 ₽   │   5000 ₽    │      —      │   5800 ₽   │
│ Мытье окон           │  1500 ₽   │      —      │   1600 ₽    │   1400 ₽   │
└──────────────────────┴───────────┴─────────────┴─────────────┴────────────┘
                                                   
                                             ┌──────────────────┐
                                             │ 📥 Экспорт в CSV │
                                             └──────────────────┘
```

**Цветовая схема:**
- 🔵 **Синяя колонка** = Наша цена (выделяется)
- ⚪ **Белые колонки** = Цены конкурентов
- ⚫ **"—"** = Услуга не найдена у конкурента

---

## 🔄 Архитектура данных

### Pipeline обработки

```
┌─────────────┐
│   USER      │
│   INPUT     │
└──────┬──────┘
       │ URLs + API Key
       ↓
┌─────────────────────────────────────┐
│   1. FETCH HTML                     │
│   ┌───────────────────────────────┐ │
│   │ • Ваш сайт (2 страницы)      │ │
│   │ • Конкурент 1                 │ │
│   │ • Конкурент 2                 │ │
│   │ • Конкурент 3                 │ │
│   └───────────────────────────────┘ │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│   2. CLEAN HTML (Cheerio)           │
│   ┌───────────────────────────────┐ │
│   │ Remove:                       │ │
│   │ • <script>                    │ │
│   │ • <style>                     │ │
│   │ • <img>, <svg>                │ │
│   │ • <iframe>                    │ │
│   │                               │ │
│   │ Extract: Text content         │ │
│   └───────────────────────────────┘ │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│   3. AI EXTRACTION (GPT-4o)         │
│   ┌───────────────────────────────┐ │
│   │ Для каждого сайта:            │ │
│   │                               │ │
│   │ Input: Clean HTML text        │ │
│   │ Prompt: "Найди ВСЕ цены"     │ │
│   │                               │ │
│   │ Output: JSON                  │ │
│   │ [                             │ │
│   │   {                           │ │
│   │     service: "Уборка 2-комн", │ │
│   │     price: "3500 руб."        │ │
│   │   }                           │ │
│   │ ]                             │ │
│   └───────────────────────────────┘ │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│   4. SERVICE MATCHING (GPT-4o)      │
│   ┌───────────────────────────────┐ │
│   │ Input:                        │ │
│   │ • Наши услуги                 │ │
│   │ • Услуги всех конкурентов     │ │
│   │                               │ │
│   │ Prompt:                       │ │
│   │ "Сопоставь ТОЛЬКО идентичные" │ │
│   │ "2-комн ≠ 3-комн"             │ │
│   │                               │ │
│   │ Output: Comparison table      │ │
│   └───────────────────────────────┘ │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│   5. RESULT TABLE                   │
│   ┌───────────────────────────────┐ │
│   │  Service  │ Us │ C1 │ C2 │ C3 │ │
│   │───────────┼────┼────┼────┼────│ │
│   │  Uborka   │ 3k │ 3k │ 4k │ — │ │
│   └───────────────────────────────┘ │
└──────────────┬──────────────────────┘
               ↓
        ┌──────────────┐
        │ USER DISPLAY │
        │   + CSV      │
        └──────────────┘
```

---

## 🎭 User Journey

### Сценарий использования

```
👤 USER START
   │
   ├─ Открывает /price-comparator
   │
   ├─ Видит форму
   │  └─ "Мне нужен API ключ"
   │
   ├─ Идет на platform.openai.com
   │  └─ Регистрируется
   │  └─ Создает API ключ
   │
   ├─ Возвращается на сайт
   │  └─ Вставляет API ключ
   │
   ├─ Заполняет URLs:
   │  ├─ Свой сайт (услуги)
   │  ├─ Свой сайт (цены)
   │  └─ 3-5 конкурентов
   │
   ├─ Нажимает "Начать анализ"
   │
   ├─ Видит прогресс в реальном времени:
   │  ├─ "Загружаем HTML..."
   │  ├─ "Анализируем ваш сайт..."
   │  ├─ "Конкурент 1/3..."
   │  ├─ "Конкурент 2/3..."
   │  ├─ "Конкурент 3/3..."
   │  └─ "Сопоставляем услуги..."
   │
   ├─ Получает результат:
   │  └─ Таблица со сравнением
   │
   ├─ Анализирует:
   │  ├─ Где мы дороже?
   │  ├─ Где дешевле?
   │  └─ Какие услуги только у нас?
   │
   ├─ Экспортирует в CSV
   │  └─ Открывает в Excel
   │
   └─ Принимает решения:
      ├─ Корректирует цены
      ├─ Добавляет новые услуги
      └─ Меняет позиционирование
   
🎯 GOAL ACHIEVED
```

---

## 📊 Data Flow (SSE)

### Server-Sent Events Timeline

```
TIME │ CLIENT                    │ SERVER
─────┼──────────────────────────┼────────────────────────────
0s   │ POST /api/...            │
     │                          │ ← Receive request
─────┼──────────────────────────┼────────────────────────────
1s   │ ← "Загружаем HTML..."    │
     │ [Update UI]              │ → Fetching URLs...
─────┼──────────────────────────┼────────────────────────────
3s   │ ← "Очищаем HTML..."      │
     │ [Update UI]              │ → Cheerio cleaning...
─────┼──────────────────────────┼────────────────────────────
5s   │ ← "Анализируем ваш..."   │
     │ [Update UI]              │ → GPT-4 call (our site)
─────┼──────────────────────────┼────────────────────────────
20s  │ ← "Конкурент 1/3..."     │
     │ [Update UI]              │ → GPT-4 call (comp 1)
─────┼──────────────────────────┼────────────────────────────
40s  │ ← "Конкурент 2/3..."     │
     │ [Update UI]              │ → GPT-4 call (comp 2)
─────┼──────────────────────────┼────────────────────────────
60s  │ ← "Конкурент 3/3..."     │
     │ [Update UI]              │ → GPT-4 call (comp 3)
─────┼──────────────────────────┼────────────────────────────
80s  │ ← "Сопоставляем..."      │
     │ [Update UI]              │ → GPT-4 matching
─────┼──────────────────────────┼────────────────────────────
100s │ ← { result: {...} }      │
     │ [Render table]           │ → Close connection
─────┼──────────────────────────┼────────────────────────────
     │ [Show export button]     │
     │                          │
```

**Всего:** ~1.5-2 минуты для 3 конкурентов

---

## 💡 Как работает AI

### GPT-4 Extraction Process

```
┌────────────────────────────────────────────────────────┐
│  INPUT: HTML Text                                      │
│  ─────────────────────────────────────────────────────│
│  Услуги клининга                                       │
│  Уборка двухкомнатной квартиры - 3500 рублей          │
│  Уборка трехкомнатной квартиры - от 4500 до 6000 руб. │
│  Генеральная уборка: цена 5500р                        │
│  Мытье окон 1500₽                                      │
└────────────────────────────────────────────────────────┘
                        ↓
┌────────────────────────────────────────────────────────┐
│  GPT-4 PROMPT                                          │
│  ─────────────────────────────────────────────────────│
│  Проанализируй текст и извлеки ВСЕ цены на услуги.    │
│                                                        │
│  ВАЖНО:                                                │
│  1. Найди все упоминания цен                           │
│  2. Извлеки точные названия услуг                      │
│  3. Сохрани диапазоны как есть                         │
│                                                        │
│  Верни JSON: [{ service, price }, ...]                │
└────────────────────────────────────────────────────────┘
                        ↓
┌────────────────────────────────────────────────────────┐
│  GPT-4 ANALYSIS                                        │
│  ─────────────────────────────────────────────────────│
│  • Распознает: "двухкомнатной" = тип услуги            │
│  • Распознает: "3500 рублей" = цена                    │
│  • Распознает: "от 4500 до 6000" = диапазон            │
│  • Распознает: "5500р" = альтернативный формат         │
│  • Распознает: "1500₽" = символ рубля                  │
└────────────────────────────────────────────────────────┘
                        ↓
┌────────────────────────────────────────────────────────┐
│  OUTPUT: Structured JSON                               │
│  ─────────────────────────────────────────────────────│
│  [                                                     │
│    {                                                   │
│      "service": "Уборка двухкомнатной квартиры",       │
│      "price": "3500 рублей"                            │
│    },                                                  │
│    {                                                   │
│      "service": "Уборка трехкомнатной квартиры",       │
│      "price": "от 4500 до 6000 руб."                   │
│    },                                                  │
│    {                                                   │
│      "service": "Генеральная уборка",                  │
│      "price": "5500 р"                                 │
│    },                                                  │
│    {                                                   │
│      "service": "Мытье окон",                          │
│      "price": "1500₽"                                  │
│    }                                                   │
│  ]                                                     │
└────────────────────────────────────────────────────────┘
```

### GPT-4 Matching Process

```
┌────────────────────────────────────────────────────────┐
│  INPUT: Our Services + Competitor Services             │
│  ─────────────────────────────────────────────────────│
│  OUR:                                                  │
│  • Уборка 2-комнатной - 3500₽                          │
│  • Уборка 3-комнатной - 4500₽                          │
│                                                        │
│  COMPETITOR:                                           │
│  • Клининг двухкомнатной квартиры - 3200₽             │
│  • Уборка четырехкомнатной - 5500₽                     │
└────────────────────────────────────────────────────────┘
                        ↓
┌────────────────────────────────────────────────────────┐
│  GPT-4 PROMPT                                          │
│  ─────────────────────────────────────────────────────│
│  Сопоставь услуги конкурентов с нашими.                │
│                                                        │
│  КРИТИЧЕСКИ ВАЖНО:                                     │
│  • Сопоставляй ТОЛЬКО идентичные услуги                │
│  • "2-комн" ≠ "3-комн" - НЕ сопоставлять!              │
│  • "Уборка" = "Клининг" - можно сопоставить            │
│                                                        │
│  Будь консервативен!                                   │
└────────────────────────────────────────────────────────┘
                        ↓
┌────────────────────────────────────────────────────────┐
│  GPT-4 LOGIC                                           │
│  ─────────────────────────────────────────────────────│
│  ✅ MATCH:                                             │
│     "Уборка 2-комн" ↔ "Клининг двухкомнатной"         │
│     (разные слова, одинаковый смысл)                   │
│                                                        │
│  ❌ NO MATCH:                                          │
│     "Уборка 2-комн" ⛔ "Уборка 3-комн"                 │
│     (разные параметры)                                 │
│                                                        │
│  ❌ NO MATCH:                                          │
│     "Уборка 3-комн" ⛔ "Уборка четырехкомнатной"       │
│     (разные параметры)                                 │
└────────────────────────────────────────────────────────┘
                        ↓
┌────────────────────────────────────────────────────────┐
│  OUTPUT: Comparison Table                              │
│  ─────────────────────────────────────────────────────│
│  {                                                     │
│    "comparison": [                                     │
│      {                                                 │
│        "service": "Уборка 2-комнатной",                │
│        "ourPrice": "3500₽",                            │
│        "competitorPrices": {                           │
│          "Competitor": "3200₽"                         │
│        }                                               │
│      },                                                │
│      {                                                 │
│        "service": "Уборка 3-комнатной",                │
│        "ourPrice": "4500₽",                            │
│        "competitorPrices": {                           │
│          "Competitor": ""  ← Пусто! (нет совпадения)   │
│        }                                               │
│      }                                                 │
│    ]                                                   │
│  }                                                     │
└────────────────────────────────────────────────────────┘
```

---

## 🎯 Success Metrics

### Что считается успешным анализом?

```
✅ УСПЕХ:
┌──────────────────────────────────────┐
│ • Все HTML загружены                 │
│ • Цены найдены на всех сайтах        │
│ • Услуги корректно сопоставлены      │
│ • Таблица заполнена данными          │
│ • CSV экспорт работает               │
└──────────────────────────────────────┘

⚠️ ЧАСТИЧНЫЙ УСПЕХ:
┌──────────────────────────────────────┐
│ • Некоторые HTML не загрузились      │
│ • Цены найдены не на всех сайтах     │
│ • Часть услуг не сопоставилась       │
│   (это OK если услуги разные!)       │
└──────────────────────────────────────┘

❌ ПРОВАЛ:
┌──────────────────────────────────────┐
│ • OpenAI API error                   │
│ • Все HTML не загрузились            │
│ • Цены не найдены нигде              │
│ • Сервер timeout                     │
└──────────────────────────────────────┘
```

---

## 📈 Performance Expectations

### Типичные показатели

```
Количество сайтов:    1 + 5 конкурентов = 6 сайтов
                                          ↓
Загрузка HTML:        ~3-5 секунд        (параллельно)
                                          ↓
Очистка HTML:         ~1 секунда         (Cheerio быстрый)
                                          ↓
AI Extraction:        ~15 секунд × 6     = ~90 секунд
                                          ↓
AI Matching:          ~10 секунд         
                                          ↓
TOTAL:                ~105 секунд        = ~1.5-2 минуты

────────────────────────────────────────────────────────

Стоимость:            $0.015 × 6 + $0.015 = ~$0.12

Точность:             85-95% (зависит от качества HTML)
```

---

**Создано:** Декабрь 2025  
**Автор:** Игорь Бурдуков  
**Telegram:** @iganiga1


